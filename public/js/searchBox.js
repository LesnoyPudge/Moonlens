let currentSelect,selectedTarget,reqBody,searchBox=document.querySelector("#search-box"),select=searchBox.querySelector("#select"),output=searchBox.querySelector("#output"),countrySelect=searchBox.querySelector("#country-select"),countryOutput=countrySelect.querySelector('[class$="__content"]'),citySelect=searchBox.querySelector("#city-select"),cityOutput=citySelect.querySelector('[class$="__content"]');export function searchBoxInit(){getClinicList(citySelect.querySelector('[data-value="0"]')),setHeight(citySelect),setHeight(countrySelect),getCountryList(),setOption(citySelect,citySelect.querySelector('[data-value="0"]')),setOption(countrySelect,countrySelect.querySelector('[data-value="0"]')),select.addEventListener("click",e=>{if(e.target.closest("#country-select"))currentSelect=countrySelect;else{if(!e.target.closest("#city-select"))return;currentSelect=citySelect}toggleState(currentSelect),setHeight(currentSelect),e.target.hasAttribute("data-checked")&&(selectedTarget=e.target,setOption(currentSelect,selectedTarget),currentSelect==countrySelect&&setCity(selectedTarget),currentSelect==citySelect&&getClinicList(selectedTarget))})}function cleanList(e){e.forEach(e=>{e.remove()})}export function toggleState(e){"close"==e.dataset.state||""==e.dataset.state?e.dataset.state="open":e.dataset.state="close"}function setHeight(e){let t=Array.from(e.querySelector('[class$="__content"]').children),c=0;t.forEach(e=>{c+=e.offsetHeight}),"close"===e.dataset.state?e.querySelector('[class$="__content"]').style.height="0px":e.querySelector('[class$="__content"]').style.height=c+t.length+"px"}function setOption(e,t){setCheck(e,t),e.querySelector(".select-text").innerText=t.innerText,e.dataset.value=t.dataset.value}async function setCity(e){let t=e.dataset.value;t&&""!=t&&("0"==t?(getClinicList(citySelect.querySelector('[data-value="0"]')),setOption(citySelect,citySelect.querySelector('[data-value="0"]')),cleanList(citySelect.querySelectorAll('[data-value]:not([data-value="0"])'))):(setOption(citySelect,citySelect.querySelector('[data-value="0"]')),await getCityList(t),getClinicList(e)),setHeight(citySelect))}async function getCountryList(){let e,t=await fetch("/getCountryList");t.ok?(await t.json()).forEach(t=>{e=`<li class="country-select__item" data-value="${t._id}" data-checked>${t.country_name}</li>`,countryOutput.insertAdjacentHTML("beforeend",e)}):console.log("Ошибка HTTP: "+t.status)}async function getCityList(e){reqBody={countryId:e};let t=await fetch("/getCityList",{method:"POST",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),mode:"same-origin",body:JSON.stringify(reqBody)});if(!t.ok)return void console.log("Ошибка HTTP: "+t.status);let c,a=await t.json();cleanList(citySelect.querySelectorAll('[data-value]:not([data-value="0"])')),a.forEach(e=>{c=`<li class="city-select__item" data-value="${e._id}" data-checked>${e.city_name}</li>`,cityOutput.insertAdjacentHTML("beforeend",c)})}async function getClinicList(e){let t=e.dataset.value;if(!t||""==t)return;cleanList(Array.from(output.children));if(e.className.includes("city")&&!countrySelect.dataset.value)switch(t){case"0":reqBody={};break;default:reqBody={dataValue:t}}else if(e.className.includes("city")&&"0"!=countrySelect.dataset.value)switch(t){case"0":t=countrySelect.dataset.value,reqBody={dataValue:t,isCountry:!0};break;default:reqBody={dataValue:t}}else if(e.className.includes("city")&&"0"==countrySelect.dataset.value)switch(t){case"0":reqBody={}}else if(e.className.includes("country"))switch(t){case"0":return;default:reqBody={dataValue:t,isCountry:!0}}let c=await fetch("/getClinicList",{method:"POST",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),mode:"same-origin",body:JSON.stringify(reqBody)});if(!c.ok)return void console.log("Ошибка HTTP: "+c.status);let a,l=await c.json(),s=1;l.forEach(e=>{a=`\n        <li class='output__item' data-id='${e._id}' data-checked>\n            <div class='output__name'>${s}. <b>${e.clinic_name}</b></div>\n            <address class='output__address'>${e.clinic_address}</address>\n            <div class='output__email'>${e.clinic_email}</div>\n            <div class='output__site'>${e.clinic_site}</div>\n            <div class='output__phone'>${e.clinic_phone}</div>\n        </li>\n        `,s++,output.insertAdjacentHTML("beforeend",a)})}export function setCheck(e,t){if(!t.dataset.checked){let t=e.querySelector("[data-checked=true]");t&&(t.dataset.checked="")}t.dataset.checked="true"}